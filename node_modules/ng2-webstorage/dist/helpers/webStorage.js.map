{"version":3,"file":"webStorage.js","sourceRoot":"","sources":["../../lib/helpers/webStorage.ts"],"names":[],"mappings":"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","sourcesContent":["import {IWebStorage} from '../interfaces/webStorage';\r\nimport {STORAGE} from '../enums/storage';\r\nimport {StorageObserverHelper} from './storageObserver';\r\nimport {KeyStorageHelper} from './keyStorage';\r\nimport {MockStorageHelper} from './mockStorage';\r\nimport {STORAGE_NAMES} from '../constants/lib';\r\n\r\nexport class WebStorageHelper {\r\n\r\n\tstatic cached = {[STORAGE.local]: {}, [STORAGE.session]: {}};\r\n\tstatic storageAvailability = {[STORAGE.local]: null, [STORAGE.session]: null};\r\n\r\n\tstatic store(sType:STORAGE, sKey:string, value:any):void {\r\n\t\tthis.getStorage(sType).setItem(sKey, JSON.stringify(value));\r\n\t\tthis.cached[sType][sKey] = value;\r\n\t\tStorageObserverHelper.emit(sType, sKey, value);\r\n\t}\r\n\r\n\tstatic retrieve(sType:STORAGE, sKey:string):string {\r\n\t\tif(this.cached[sType][sKey]) return this.cached[sType][sKey];\r\n\t\treturn this.cached[sType][sKey] = WebStorageHelper.retrieveFromStorage(sType, sKey);\r\n\t}\r\n\r\n\tstatic retrieveFromStorage(sType:STORAGE, sKey:string) {\r\n\t\tlet data = null;\r\n\r\n\t\ttry {\r\n\t\t\tdata = JSON.parse(this.getStorage(sType).getItem(sKey));\r\n\t\t} catch(err) {\r\n\t\t\tconsole.warn(`invalid value for ${sKey}`);\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tstatic refresh(sType:STORAGE, sKey:string) {\r\n\t\tif(!KeyStorageHelper.isManagedKey(sKey)) return;\r\n\r\n\t\tlet value = WebStorageHelper.retrieveFromStorage(sType, sKey);\r\n\t\tif(value === null) {\r\n\t\t\tdelete this.cached[sType][sKey];\r\n\t\t\tStorageObserverHelper.emit(sType, sKey, null);\r\n\t\t}\r\n\t\telse if(value !== this.cached[sType][sKey]) {\r\n\t\t\tthis.cached[sType][sKey] = value;\r\n\t\t\tStorageObserverHelper.emit(sType, sKey, value);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic clearAll(sType:STORAGE):void {\r\n\t\tlet storage:IWebStorage = this.getStorage(sType);\r\n\t\tKeyStorageHelper.retrieveKeysFromStorage(storage)\r\n\t\t.forEach((sKey) => {\r\n\t\t\tstorage.removeItem(sKey);\r\n\t\t\tdelete this.cached[sType][sKey];\r\n\t\t\tStorageObserverHelper.emit(sType, sKey, null);\r\n\t\t});\r\n\t}\r\n\r\n\tstatic clear(sType:STORAGE, sKey:string):void {\r\n\t\tthis.getStorage(sType).removeItem(sKey);\r\n\t\tdelete this.cached[sType][sKey];\r\n\t\tStorageObserverHelper.emit(sType, sKey, null);\r\n\t}\r\n\r\n\tstatic getStorage(sType:STORAGE):IWebStorage {\r\n\t\treturn this.isStorageAvailable(sType) ? this.getWStorage(sType) : MockStorageHelper.getStorage(sType);\r\n\t}\r\n\r\n\tstatic getWStorage(sType:STORAGE):IWebStorage {\r\n\t\tlet storage;\r\n\t\tswitch(sType) {\r\n\t\t\tcase STORAGE.local:\r\n\t\t\t\tstorage = localStorage;\r\n\t\t\t\tbreak;\r\n\t\t\tcase STORAGE.session:\r\n\t\t\t\tstorage = sessionStorage;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow Error('invalid storage type');\r\n\t\t}\r\n\t\treturn storage;\r\n\t}\r\n\r\n\tstatic isStorageAvailable(sType:STORAGE) {\r\n\t\tif(typeof this.storageAvailability[sType] === 'boolean')\r\n\t\t\treturn this.storageAvailability[sType];\r\n\r\n\t\tlet isAvailable = true, storage = this.getWStorage(sType);\r\n\r\n\t\tif(typeof storage === 'object') {\r\n\t\t\ttry {\r\n\t\t\t\tstorage.setItem('test-storage', 'foobar');\r\n\t\t\t\tstorage.removeItem('test-storage');\r\n\t\t\t} catch(e) {\r\n\t\t\t\tisAvailable = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse isAvailable = false;\r\n\r\n\t\tif(!isAvailable) console.warn(`${STORAGE_NAMES[sType]} storage unavailable, Ng2Webstorage will use a fallback strategy instead`);\r\n\t\treturn this.storageAvailability[sType] = isAvailable;\r\n\t}\r\n\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}